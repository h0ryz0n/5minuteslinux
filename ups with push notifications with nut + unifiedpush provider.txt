setting up NUT with optional push notifications with nextcloud on your phone, in no time  
  
  
assuming you have:  
an UPS ;-)  
nut/nut-server/nut-monitor installed  
optional:  
curl for push notifications sending  
nextcloud with unifiedpush provider  
nextpush on your phone  
  
I'm using a Tecnoware UPS, cheap one but it does his job  
for replacement, get a YUASA NP7â€“12L (L=faston 6,3 mm)  
  
*in /etc/nut/nut.conf  
  
MODE=standalone  
  
  
*in /etc/nut/ups.conf  
  
[tecnoware]
        #driver = "blazer_usb" #it works, but it's considered deprecated
        driver = "nutdrv_qx"
        port = "auto" # for usb
        desc = "Tecnoware UPS ERA PLUS 1100"


*in /etc/nut/upsd.users

[admin]
password = mydumbpassword
actions = SET
instcmds = ALL
upsmon = primary


*in /etc/nut/upsmon.conf

MONITOR tecnoware@localhost 1 admin mydumbpassword primary

# all my events - feel free to remove/add -> EXEC = execute NOTIFYCMD
NOTIFYFLAG ONLINE       SYSLOG+WALL+EXEC
NOTIFYFLAG ONBATT       SYSLOG+WALL+EXEC
NOTIFYFLAG LOWBATT      SYSLOG+WALL+EXEC
NOTIFYFLAG FSD          SYSLOG+WALL+EXEC
NOTIFYFLAG COMMOK       SYSLOG+WALL+EXEC
NOTIFYFLAG COMMBAD      SYSLOG+WALL+EXEC
NOTIFYFLAG SHUTDOWN     SYSLOG+WALL+EXEC
NOTIFYFLAG REPLBATT     SYSLOG+WALL+EXEC
NOTIFYFLAG NOCOMM       SYSLOG+WALL+EXEC
NOTIFYFLAG NOPARENT     SYSLOG+WALL+EXEC
NOTIFYFLAG CAL          SYSLOG+WALL+EXEC
NOTIFYFLAG OFF          SYSLOG+WALL+EXEC
NOTIFYFLAG NOTOFF       SYSLOG+WALL+EXEC
NOTIFYFLAG BYPASS       SYSLOG+WALL+EXEC
NOTIFYFLAG NOTBYPASS    SYSLOG+WALL+EXEC


how to get the push notifications:

add a new channel in nextpush & take note of its endpoint url
(long press on nextpush & check on nextcloud app if the channel has been added)

*in /etc/nut/upsmon.conf:
NOTIFYCMD /usr/local/bin/ups-push.sh

now we'll create our wrapper script

*in /usr/local/bin/ups-push.sh

#!/bin/bash

# Nextcloud push endpoint:
URL="https://nextcloud.mydumbserver.cow/..../endpoint"

# $1 = full NOTIFYMSG text
# $UPSNAME, $NOTIFYTYPE, $HOSTNAME, $BCHARGE, $LOADPCT are inherited from upsmon environment
MSG="$HOSTNAME - UPS $UPSNAME - $NOTIFYTYPE - $1"
MSG="$MSG - Battery: ${BCHARGE:-N/A}% - Load: ${LOADPCT:-N/A}%"

# send asynchronously with timeout 5s
timeout 5 curl -s -k -X POST -d "$MSG" "$URL" >/dev/null 2>&1 &
# exit immediately to avoid blocking upsmon
exit 0

if you want to test if the wrapper script works:
UPSNAME="apc-backup" NOTIFYTYPE="LOWBATT" HOSTNAME="mydumbserver" BCHARGE="42" LOADPCT="35" /usr/local/bin/ups-push.sh "test: UPS battery is OK"
